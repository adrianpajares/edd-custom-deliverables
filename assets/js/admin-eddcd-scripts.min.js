jQuery(document).ready(function(e){var t={init:function(){this.add(),this.move(),this.remove(),this.files()},clone_repeatable:function(t){var d=highest=1;return t.parent().find(".eddcd_repeatable_row").each(function(){var t=e(this).data("key");parseInt(t)>highest&&(highest=t)}),d=highest+=1,clone=t.clone(),clone.find("select").each(function(){e(this).val(t.find('select[name="'+e(this).attr("name")+'"]').val())}),clone.removeClass("edd_add_blank"),clone.attr("data-key",d),clone.find("input, select, textarea").val("").each(function(){var t=e(this).attr("name"),a=e(this).attr("id");t&&(t=t.replace(/\[(.*?)\]\[(.*?)\]\[(.*?)\]/,function(e,t,a,i){return"["+t+"]["+a+"]["+parseInt(d)+"]"}),e(this).attr("name",t)),e(this).attr("data-key",d),void 0!==a&&(a=a.replace(/(\d+)/,parseInt(d)),e(this).attr("id",a))}),clone.find("span.eddcd_price_id").each(function(){e(this).text(parseInt(d))}),clone.find("span.eddcd_file_id").each(function(){e(this).text(parseInt(d))}),clone.find(".eddcd_repeatable_default_input").each(function(){e(this).val(parseInt(d)).removeAttr("checked")}),clone.find(".eddcd_repeatable_condition_field").each(function(){e(this).find("option:eq(0)").prop("selected","selected")}),clone.find(".search-choice").remove(),clone.find(".chosen-container").remove(),clone},add:function(){e(document.body).on("click",".submit .eddcd_add_repeatable",function(d){d.preventDefault();var a=e(this);e(this).attr("download-id");price_id=e(this).attr("price-id"),row=a.parent().parent().prev(".eddcd_repeatable_row"),clone=t.clone_repeatable(row),clone.insertAfter(row).find("input, textarea, select").filter(":visible").eq(0).focus(),clone.find(".edd-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_single:edd_vars.one_option,placeholder_text_multiple:edd_vars.one_or_more_option}),clone.find(".edd-select-chosen").css("width","100%"),clone.find(".edd-select-chosen .chosen-search input").attr("placeholder",edd_vars.search_placeholder)})},move:function(){e(".eddcd_repeatable_table .eddcd-repeatables-wrap").sortable({handle:".eddcd-draghandle-anchor",items:".eddcd_repeatable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var t=0;console.log("heyo"),e(this).find(".eddcd_repeatable_row").each(function(){e(this).find("input.eddcd_repeatable_index").each(function(){e(this).val(t)}),t++})}})},remove:function(){e(document.body).on("click",".eddcd-remove-row",function(t){t.preventDefault();var d,a=e(this).parents(".eddcd_repeatable_row"),i=a.parent().find(".eddcd_repeatable_row").length-1,n=e(this).data("type"),l="div.eddcd_repeatable_"+n+"s";d=(e(this).is(".ui-sortable .eddcd_repeatable_row:first-child .edd-remove-row")?a.next(".eddcd_repeatable_row"):a.prev(".eddcd_repeatable_row")).find("select, input, textarea, button").filter(":visible").eq(0);var s=e(this).attr("download-id"),o=e(this).attr("price-id");if(e("#edd-custom-deliverables-files-"+s+"-"+o+' .eddcd_repeatable_upload_wrapper[data-key="'+a.data("key")+'"]').remove(),i>1)e("input, select",a).val(""),a.fadeOut("fast").remove(),d.focus();else switch(n){case"price":alert(edd_vars.one_price_min);break;case"file":e("input, select",a).val("");break;default:alert(edd_vars.one_field_min)}e(l).each(function(t){e(this).find("input, select").each(function(){var d=e(this).attr("name");d=d.replace(/\[(.*?)\]\[(.*?)\]\[(.*?)\]/,function(e,d,a,i){return console.log(e),"["+d+"]["+a+"]["+t+"]"}),e(this).attr("name",d).attr("id",d)})})})},files:function(){window.formfield="",e(document.body).on("click",".eddcd_upload_file_button",function(a){a.preventDefault();var i=e(this);window.formfield=e(this).closest(".eddcd_repeatable_upload_wrapper"),d?d.open():((d=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:i.data("uploader-title"),button:{text:i.data("uploader-button-text")},multiple:"0"!=e(this).data("multiple")})).on("menu:render:default",function(e){var t={};e.unset("library-separator"),e.unset("gallery"),e.unset("featured-image"),e.unset("embed"),e.set(t)}),d.on("insert",function(){d.state().get("selection").each(function(d,a){var i="image"===(d=d.toJSON()).type&&e(".attachment-display-settings .size option:selected").val(),n=d.url,l=d.title.length>0?d.title:d.filename;if(i&&void 0!==d.sizes[i]&&(n=d.sizes[i].url),"image"===d.type&&(l=i&&void 0!==d.sizes[i]?l+"-"+d.sizes[i].width+"x"+d.sizes[i].height:l+"-"+d.width+"x"+d.height),0===a)window.formfield.find(".eddcd_repeatable_attachment_id_field").val(d.id),window.formfield.find(".eddcd_repeatable_thumbnail_size_field").val(i),window.formfield.find(".eddcd_repeatable_upload_field").val(n),window.formfield.find(".eddcd_repeatable_name_field").val(l);else{var s=window.formfield,o=t.clone_repeatable(s);o.find(".eddcd_repeatable_attachment_id_field").val(d.id),o.find("edd_repeatable_thumbnail_size_field").val(i),o.find(".eddcd_repeatable_upload_field").val(n),o.find(".eddcd_repeatable_name_field").val(l),o.insertAfter(s)}})}),d.open(),e(".edd-custom-deliverables-send-email-wrapper").html(edd_custom_deliverables_vars.save_payment_text))});var d;window.formfield=""}};t.init(),e(document).on("click","#edd-custom-deliverables-email-customer",function(t){e(".edd-custom-deliverables-send-email-wrapper .spinner").css("visibility","visible"),e("#edd-custom-deliverables-email-customer").css("display","none");var d;d=e("#wp-edd-custom-deliverables-email-body-wrap").hasClass("tmce-active")?tinyMCE.activeEditor.getContent():jQuery("#edd-custom-deliverables-email-body").val(),e.ajax({type:"POST",url:ajaxurl,data:{nonce:e("#edd-custom-deliverables-send-email").val(),subject:e("#edd-custom-deliverables-subject").val(),body:d,payment_id:e("#edd-custom-deliverables-payment-id").val(),action:"edd_custom_deliverables_send_email_ajax"},dataType:"json",success:function(t){t.success?(e(".edd-custom-deliverables-send-email-wrapper .spinner").css("visibility","hidden"),e("#edd-custom-deliverables-email-customer").after('<span id="edd-custom-deliverables-email-successful-message">'+t.success_message+"</span>"),setTimeout(function(){location.reload()},2e3)):console.log(t)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})});
