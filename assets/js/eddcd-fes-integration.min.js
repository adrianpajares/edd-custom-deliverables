jQuery(document).ready(function(e){var t={init:function(){this.add(),this.move(),this.remove(),this.files()},clone_repeatable:function(t){var d=highest=1;return t.parent().find(".eddcd_repeatable_row").each(function(){var t=e(this).data("key");parseInt(t)>highest&&(highest=t)}),d=highest+=1,clone=t.clone(),clone.find("select").each(function(){e(this).val(t.find('select[name="'+e(this).attr("name")+'"]').val())}),clone.removeClass("edd_add_blank"),clone.attr("data-key",d),clone.find("input, select, textarea").val("").each(function(){var t=e(this).attr("name"),a=e(this).attr("id");t&&(t=t.replace(/\[(.*?)\]\[(.*?)\]\[(.*?)\]/,function(e,t,a,i){return"["+t+"]["+a+"]["+parseInt(d)+"]"}),e(this).attr("name",t)),e(this).attr("data-key",d),void 0!==a&&(a=a.replace(/(\d+)/,parseInt(d)),e(this).attr("id",a))}),clone.find("span.eddcd_price_id").each(function(){e(this).text(parseInt(d))}),clone.find("span.eddcd_file_id").each(function(){e(this).text(parseInt(d))}),clone.find(".eddcd_repeatable_default_input").each(function(){e(this).val(parseInt(d)).removeAttr("checked")}),clone.find(".eddcd_repeatable_condition_field").each(function(){e(this).find("option:eq(0)").prop("selected","selected")}),clone.find(".search-choice").remove(),clone.find(".chosen-container").remove(),clone},add:function(){e(document.body).on("click",".submit .eddcd_add_repeatable",function(d){d.preventDefault();var a=e(this);e(this).attr("download-id");price_id=e(this).attr("price-id"),row=a.parent().parent().prev(".eddcd_repeatable_row"),clone=t.clone_repeatable(row),clone.insertAfter(row).find("input, textarea, select").filter(":visible").eq(0).focus()})},move:function(){e(".eddcd_repeatable_table .eddcd-repeatables-wrap").sortable({handle:".eddcd-draghandle-anchor",items:".eddcd_repeatable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var t=0;e(this).find(".eddcd_repeatable_row").each(function(){e(this).find("input.eddcd_repeatable_index").each(function(){e(this).val(t)}),t++})}})},remove:function(){e(document.body).on("click",".eddcd-remove-row",function(t){t.preventDefault();var d,a=e(this).parents(".eddcd_repeatable_row"),i=a.parent().find(".eddcd_repeatable_row").length,n=e(this).data("type");d=(e(this).is(".ui-sortable .eddcd_repeatable_row:first-child .edd-remove-row")?a.next(".eddcd_repeatable_row"):a.prev(".eddcd_repeatable_row")).find("select, input, textarea, button").filter(":visible").eq(0);var l=e(this).attr("download-id"),r=e(this).attr("price-id");if(i>1)e("input, select",a).val(""),a.fadeOut("fast").remove(),d.focus(),e("#edd-custom-deliverables-files-"+l+"-"+r+' .eddcd_repeatable_upload_wrapper[data-key="'+a.data("key")+'"]').remove();else switch(n){case"price":alert(edd_vars.one_price_min);break;case"file":e("input, select",a).val("");break;default:alert(edd_vars.one_field_min)}})},files:function(t){e(document.body).on("click",".eddcd_upload_file_button",function(t){var d,a=e(this);d?d.open():((d=wp.media({title:fes_form.file_title,button:{text:fes_form.file_button},multiple:!1})).on("open",function(){var t=a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_attachment_id_field").attr("data-formid"),d=a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_attachment_id_field").attr("data-fieldname");e.post(fes_form.ajaxurl,{action:"fes_turn_on_file_filter",formid:t,name:d},function(e){})}),d.on("close",function(){var t=a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_attachment_id_field").attr("data-formid"),d=a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_attachment_id_field").attr("data-fieldname");e.post(fes_form.ajaxurl,{action:"fes_turn_off_file_filter",formid:t,name:d},function(e){})}),d.on("select",function(){d.state().get("selection").map(function(e){e=e.toJSON(),a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_attachment_id_field").val(e.id),a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_name_field").val(e.title),a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_upload_field").val(e.url)})}),d.open(),e(".edd-custom-deliverables-send-email-wrapper").html(edd_custom_deliverables_fes_vars.save_payment_text))})}};t.init(),e(document).on("click","#edd-custom-deliverables-email-customer",function(t){e(".edd-custom-deliverables-send-email-wrapper .spinner").css("visibility","visible"),e("#edd-custom-deliverables-email-customer").css("display","none");var d;d=e("#wp-edd-custom-deliverables-email-body-wrap").hasClass("tmce-active")?tinyMCE.activeEditor.getContent():jQuery("#edd-custom-deliverables-email-body").val(),e.ajax({type:"POST",url:ajaxurl,data:{nonce:e("#edd-custom-deliverables-send-email").val(),subject:e("#edd-custom-deliverables-subject").val(),body:d,payment_id:e("#edd-custom-deliverables-payment-id").val(),action:"edd_custom_deliverables_send_email_ajax"},dataType:"json",success:function(t){t.success?(e(".edd-custom-deliverables-send-email-wrapper .spinner").css("visibility","hidden"),e("#edd-custom-deliverables-email-customer").after('<span id="edd-custom-deliverables-email-successful-message">'+t.success_message+"</span>"),setTimeout(function(){location.reload()},2e3)):console.log(t)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})});
